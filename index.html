<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAHIM's App | The Ultimate Hub - Futuristic Content & Games</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Font Awesome (for icons and chess pieces) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #0d1117; /* Dark background */
            --accent-color: #00f0ff; /* Neon Cyan */
            --secondary-accent: #ff0077; /* Neon Pink */
            --text-light: #e6e6e6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-color);
            color: var(--text-light);
            overflow: hidden;
        }

        /* Custom Scrollbar for inner content */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 2px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: var(--primary-color);
        }
        
        /* Neon Button Effect */
        .neon-btn {
            box-shadow: 0 0 5px var(--accent-color), 0 0 10px var(--accent-color), 0 0 15px var(--accent-color);
            transition: all 0.3s ease;
        }
        .neon-btn:hover {
            background-color: var(--accent-color);
            color: var(--primary-color);
            box-shadow: 0 0 10px var(--accent-color), 0 0 25px var(--accent-color), 0 0 40px var(--accent-color);
        }

        /* Futuristic Card Hover Effect */
        .futuristic-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(0, 240, 255, 0.2);
            backdrop-filter: blur(5px);
            background-color: rgba(13, 17, 23, 0.7);
        }
        .futuristic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 240, 255, 0.3);
        }

        /* Animation for screen transition */
        .screen {
            animation: fadeIn 0.5s ease-out;
            display: none;
            overflow-y: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Set App container dimensions for mobile view */
        #app-container {
            max-width: 420px; /* Typical max mobile width */
            height: 100vh;
            margin: auto;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 240, 255, 0.2);
        }

        /* --- CHESS BOARD STYLING --- */
        #chess-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 95%;
            aspect-ratio: 1 / 1;
            margin: 2.5%;
            border: 4px solid var(--accent-color);
            box-shadow: 0 0 15px var(--accent-color);
        }
        .chess-square {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px; /* For Emojis/Icons */
            cursor: pointer;
            transition: background-color 0.1s ease;
        }
        .light { background-color: #b58863; }
        .dark { background-color: #644a30; }
        .selected { background-color: var(--secondary-accent) !important; opacity: 0.8; }
        .highlight { background-color: rgba(0, 240, 255, 0.5); }
        .white-piece { color: #f0d9b5; }
        .black-piece { color: #202020; }
        
        .thinking {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <!-- Main App Container (Simulating Android Screen) -->
    <div id="app-container" class="relative bg-gray-900 flex flex-col rounded-3xl overflow-hidden">
        
        <!-- 1. SPLASH SCREEN / OFFLINE CHECK -->
        <div id="splash-screen" class="screen flex flex-col items-center justify-center h-full w-full absolute top-0 left-0 z-50 bg-gray-900 transition-opacity duration-500">
            <img src="uploaded:Gemini_Generated_Image_g3411ig3411ig341.jpg-0f89a13e-b5ef-40c2-88d0-87c4b06aefbf" alt="RAHIM's Logo - Campurtapipasti" class="w-40 h-40 animate-pulse mb-8" />
            <div id="loading-status" class="text-xl text-white font-medium tracking-wider">Memuat Konten Digital...</div>
            <div id="offline-message" class="hidden text-center p-8 bg-red-900/50 mt-10 rounded-xl border border-red-500/50">
                <i class="fas fa-exclamation-triangle text-red-400 text-4xl mb-4"></i>
                <h2 class="text-2xl font-bold text-red-300 mb-2">Ups! Koneksi Terputus.</h2>
                <p class="text-red-200">Aplikasi ini memerlukan jaringan internet untuk menampilkan konten inspiratif dan *real-time*. Silakan periksa koneksi Anda dan coba lagi.</p>
            </div>
        </div>

        <!-- APP HEADER (Visible on all main screens) -->
        <header id="app-header" class="hidden p-4 bg-gray-800/80 backdrop-blur-sm shadow-xl z-20 flex justify-between items-center sticky top-0 border-b border-accent-color/20">
            <h1 class="text-xl font-bold text-accent-color">RAHIM's App</h1>
            <button id="show-about-me" class="text-sm px-3 py-1 bg-secondary-accent/20 text-secondary-accent rounded-full hover:bg-secondary-accent/50 transition duration-300">About Me</button>
        </header>

        <!-- APP CONTENT VIEWER (Main area for switching screens) -->
        <div id="app-content-viewer" class="flex-grow w-full relative custom-scrollbar">

            <!-- 2. HOME SCREEN (Quotes + About) -->
            <div id="home-screen" data-screen-name="home" class="screen h-full w-full pb-28">
                <!-- Quote Slider/Carousel -->
                <div id="quote-slider" class="relative w-full h-80 overflow-hidden shadow-2xl">
                    <div id="slides-container" class="relative w-full h-full"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/10 to-transparent flex flex-col justify-end p-6">
                        <div class="text-3xl font-extrabold leading-snug text-white drop-shadow-lg" id="current-quote-text"></div>
                        <p class="text-sm text-accent-color mt-2" id="current-quote-source"></p>
                    </div>
                    <div class="absolute bottom-4 right-4 flex space-x-2" id="quote-nav-dots"></div>
                </div>

                <!-- About Me Section -->
                <div id="about-me-section" class="p-4 pt-8">
                    <h2 class="text-3xl font-extrabold text-white mb-4 border-l-4 border-secondary-accent pl-3">Tentang Pencipta <span class="text-secondary-accent">Aplikasi</span></h2>
                    <div class="futuristic-card p-6 rounded-2xl shadow-lg">
                        <p class="text-base leading-relaxed text-gray-300">
                            Halo! Saya <span class="text-accent-color font-bold">Abd. Rahim</span>, seorang siswa SMK yang penuh semangat dari Indonesia. Proyek web aplikasi ini, yang saya namakan <span class="text-secondary-accent font-bold">Campurtapipasti</span>, adalah sebuah misi untuk menggabungkan kreativitas, teknologi, dan inspirasi dalam satu platform yang *futuristik*.
                        </p>
                        <p class="text-base leading-relaxed text-gray-300 mt-4 italic text-sm border-t border-accent-color/30 pt-3">
                            <i class="fas fa-rocket text-accent-color mr-2"></i> Aplikasi ini adalah bukti bahwa anak SMK pun dapat membuat sesuatu yang luarbiasa keren.
                        </p>
                    </div>
                </div>
            </div>

            <!-- 3. POETRY SCREEN -->
            <div id="poetry-screen" data-screen-name="poetry" class="screen p-4 pb-28">
                <h2 class="text-3xl font-extrabold text-accent-color mb-6 border-b border-accent-color/50 pb-2">Kumpulan <span class="text-white">10 Puisi</span></h2>
                
                <!-- NEW: Visual Ayah Gradasi Keren -->
                <div class="futuristic-card p-4 mb-6 rounded-2xl shadow-xl">
                    <h3 class="text-xl font-bold text-secondary-accent mb-3">Visualisasi Ayah: Inspirasi Utama</h3>
                    <div class="h-40 rounded-xl bg-gradient-to-br from-indigo-900 via-gray-900 to-cyan-900 flex items-center justify-center relative overflow-hidden">
                        <i class="fas fa-user-circle text-white text-opacity-20 text-[100px] absolute"></i>
                        <div class="text-center z-10 p-4">
                            <p class="text-white text-lg font-bold">"Ayah: Pahlawan Tanpa Tanda Jasa"</p>
                            <p class="text-accent-color text-sm mt-1">Sederhana, namun Kekuatan Tak Terhingga.</p>
                        </div>
                    </div>
                </div>
                
                <div id="poetry-list" class="space-y-6"></div>
            </div>

            <!-- 4. SHORT STORY SCREEN -->
            <div id="story-screen" data-screen-name="story" class="screen p-4 pb-28">
                <h2 class="text-3xl font-extrabold text-secondary-accent mb-6 border-b border-secondary-accent/50 pb-2">Cerpen: <span class="text-white">Kisah Singkat Inspiratif</span></h2>
                <div id="story-content" class="futuristic-card p-6 rounded-2xl"></div>
            </div>

            <!-- 5. STAND UP JOKES SCREEN -->
            <div id="standup-screen" data-screen-name="standup" class="screen p-4 pb-28">
                <h2 class="text-3xl font-extrabold text-accent-color mb-6 border-b border-accent-color/50 pb-2">15 Cerita Stand Up <span class="text-white">Keren</span></h2>
                <div id="standup-list" class="space-y-4"></div>
            </div>
            
            <!-- NEW SCREEN 6: CHESS GAME -->
            <div id="chess-screen" data-screen-name="chess" class="screen flex flex-col items-center justify-start pt-4 pb-28">
                <h2 class="text-3xl font-extrabold text-white mb-4 border-b border-accent-color/50 pb-2"><span class="text-accent-color">Main</span> Catur vs AI</h2>
                <div id="chess-board" class="shadow-2xl">
                    <!-- Chess board squares and pieces are injected here by JS -->
                </div>
                <div class="mt-4 p-3 futuristic-card text-center w-full max-w-xs rounded-xl" id="chess-status-box">
                    <p id="chess-status" class="text-lg font-medium text-secondary-accent">Giliran Putih (Click untuk Pindah)</p>
                    <button id="reset-chess-btn" class="mt-3 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition">Reset Papan</button>
                </div>
            </div>

            <!-- NEW SCREEN 7: PUZZLE GAME (100 SOAL) -->
            <div id="puzzle-screen" data-screen-name="puzzle" class="screen p-4 pb-28">
                <h2 class="text-3xl font-extrabold text-white mb-6 border-b border-secondary-accent/50 pb-2"><span class="text-secondary-accent">100</span> Teka-Teki Lucu</h2>
                <div id="puzzle-container" class="futuristic-card p-6 rounded-2xl shadow-lg">
                    <p class="text-xs text-gray-400 mb-1" id="puzzle-progress">Soal 1 dari 100</p>
                    <div class="h-2 bg-gray-700 rounded-full mb-4">
                        <div id="puzzle-bar" class="h-2 bg-accent-color rounded-full transition-all duration-500" style="width: 1%"></div>
                    </div>
                    
                    <h3 class="text-xl font-bold text-accent-color mb-4" id="puzzle-question"></h3>
                    <div id="puzzle-message" class="text-lg font-bold hidden mb-3"></div>

                    <input type="text" id="puzzle-input" placeholder="Jawab di sini..." class="w-full p-3 mb-4 bg-gray-700 text-white rounded-lg border border-accent-color/50 focus:ring-2 focus:ring-accent-color focus:border-transparent transition duration-300">
                    
                    <button id="submit-answer-btn" class="w-full neon-btn bg-accent-color/20 text-accent-color font-bold py-3 rounded-lg">Jawab</button>
                </div>
            </div>

            <!-- NEW SCREEN 8: MY HISTORY VISUALS -->
            <div id="history-screen" data-screen-name="history" class="screen p-4 pb-28">
                <h2 class="text-3xl font-extrabold text-secondary-accent mb-6 border-b border-secondary-accent/50 pb-2">My <span class="text-white">History Visuals</span></h2>
                
                <!-- Tab Navigation -->
                <div class="flex space-x-2 mb-4 overflow-x-auto pb-2">
                    <button data-theme="sekolah" class="history-tab px-4 py-2 rounded-full text-sm font-medium bg-secondary-accent/20 text-secondary-accent border border-secondary-accent transition duration-300">Sekolah</button>
                    <button data-theme="medsos" class="history-tab px-4 py-2 rounded-full text-sm font-medium bg-gray-700 text-gray-400 hover:bg-secondary-accent/10 hover:text-secondary-accent transition duration-300">Medsos</button>
                    <button data-theme="kluarga" class="history-tab px-4 py-2 rounded-full text-sm font-medium bg-gray-700 text-gray-400 hover:bg-secondary-accent/10 hover:text-secondary-accent transition duration-300">Keluarga</button>
                    <button data-theme="general" class="history-tab px-4 py-2 rounded-full text-sm font-medium bg-gray-700 text-gray-400 hover:bg-secondary-accent/10 hover:text-secondary-accent transition duration-300">General</button>
                </div>

                <!-- History Content Area -->
                <div id="history-content-area" class="futuristic-card p-6 rounded-2xl shadow-lg">
                    <!-- Content will be injected/switched by JS -->
                </div>
            </div>

        </div>

        <!-- APP FOOTER (Navigation Bar - 7 Items) -->
        <footer id="app-footer" class="hidden w-full h-20 bg-gray-800/90 backdrop-blur-sm shadow-inner shadow-accent-color/20 z-10 fixed bottom-0 border-t border-accent-color/20">
            <nav class="flex justify-around items-center h-full text-xs">
                <button data-target="home" class="nav-btn flex flex-col items-center p-1 text-accent-color transition duration-300 min-w-[12%]">
                    <i class="fas fa-home text-xl"></i>
                    <span class="mt-1">Beranda</span>
                </button>
                <button data-target="poetry" class="nav-btn flex flex-col items-center p-1 text-gray-400 hover:text-accent-color transition duration-300 min-w-[12%]">
                    <i class="fas fa-feather-alt text-xl"></i>
                    <span class="mt-1">Puisi</span>
                </button>
                <button data-target="story" class="nav-btn flex flex-col items-center p-1 text-gray-400 hover:text-accent-color transition duration-300 min-w-[12%]">
                    <i class="fas fa-book-open text-xl"></i>
                    <span class="mt-1">Cerpen</span>
                </button>
                <button data-target="standup" class="nav-btn flex flex-col items-center p-1 text-gray-400 hover:text-accent-color transition duration-300 min-w-[12%]">
                    <i class="fas fa-microphone-alt text-xl"></i>
                    <span class="mt-1">Stand Up</span>
                </button>
                <button data-target="chess" class="nav-btn flex flex-col items-center p-1 text-gray-400 hover:text-accent-color transition duration-300 min-w-[12%]">
                    <i class="fas fa-chess-knight text-xl"></i>
                    <span class="mt-1">Catur</span>
                </button>
                <button data-target="puzzle" class="nav-btn flex flex-col items-center p-1 text-gray-400 hover:text-accent-color transition duration-300 min-w-[12%]">
                    <i class="fas fa-brain text-xl"></i>
                    <span class="mt-1">Teka-Teki</span>
                </button>
                <button data-target="history" class="nav-btn flex flex-col items-center p-1 text-gray-400 hover:text-accent-color transition duration-300 min-w-[12%]">
                    <i class="fas fa-history text-xl"></i>
                    <span class="mt-1">Histori</span>
                </button>
            </nav>
        </footer>

    </div>

    <!-- Modal for About Me -->
    <div id="about-modal" class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-lg items-center justify-center p-4">
        <div class="bg-gray-800/90 rounded-2xl w-full max-w-sm border border-secondary-accent p-6 shadow-2xl relative animate-fadeIn">
            <button id="close-about-modal" class="absolute top-4 right-4 text-secondary-accent hover:text-white transition"><i class="fas fa-times"></i></button>
            <h3 class="text-2xl font-bold text-secondary-accent mb-4">Tentang Aplikasi</h3>
            <p class="text-gray-300 text-sm italic">
                Aplikasi ini adalah wadah inspirasi, hiburan, dan eksplorasi seni kata, dibuat oleh <span class="font-bold">Abd. Rahim</span> saat masih SMK. Didesain dengan estetika futuristik, ia menyajikan konten, game, dan cerita personal.
            </p>
            <p class="mt-4 text-xs text-gray-400 border-t border-gray-700 pt-3">
                Proyek ini menggunakan Tailwind CSS, Vanilla JS, dan Firebase Firestore.
            </p>
        </div>
    </div>


    <!-- Firebase & JS Logic -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, onSnapshot, collection, doc, setDoc, query, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;
        let isAuthReady = false;

        // --- DATA STATE ---
        const appState = {
            quotes: [],
            poetry: [],
            story: [],
            standup: [],
            puzzles: [],
            currentSlideIndex: 0,
            currentScreen: 'home',
            currentPuzzleIndex: 0,
            chessSelectedSquare: null,
            isAITurn: false, // NEW: State to control AI turn
            historyTheme: 'sekolah'
        };

        // --- PLACEHOLDER DATA STRUCTURE ---
        const initialData = {
            quotes: [
                { id: 'q1', text: "Masa depan dibentuk oleh apa yang kamu lakukan hari ini, bukan besok.", source: "Abd. Rahim", image: 'https://placehold.co/420x320/003d3d/ffffff?text=Cinematic+Vision' },
                { id: 'q2', text: "Kesalahan adalah bukti bahwa kamu telah mencoba.", source: "Anonim", image: 'https://placehold.co/420x320/3d003d/ffffff?text=Inspirasi+Malam' },
                { id: 'q3', text: "Jadilah dirimu sendiri. Orang lain sudah diambil.", source: "Oscar Wilde", image: 'https://placehold.co/420x320/3d3d00/ffffff?text=Filosofi+Hidup' },
                { id: 'q4', text: "Setiap langkah kecil adalah kemajuan.", source: "SMK Project", image: 'https://placehold.co/420x320/3d0000/ffffff?text=Semangat+Belajar' },
            ],
            poetry: [
                { id: 'p1', title: "Senja di Ujung Kota", content: "Senja datang membawa janji, peluk hangat di kaki langit. Merah jingga mewarnai sepi, jiwa mencari damai abadi." },
                { id: 'p2', title: "Rindu Digital", content: "Layar bercahaya, notifikasi membisu. Jarak tak terukur, rindu kian menderu. Dalam piksel dan data, hati tetap merangkai kata." },
                { id: 'p3', title: "Pelajar Pemburu Mimpi", content: "Tas punggung berat, langkah kaki cepat. Sekolah adalah arena, mimpi adalah senjata. Peluh mengalir, ilmu dikejar." },
            ],
            story: [
                { id: 's1', title: "Lampu Kota dan Sepotong Harapan", content: "Di balik keramaian ibu kota, seorang pemuda bernama Tio menemukan sebuah buku tua yang mengubah seluruh pandangannya tentang kegagalan dan kesuksesan. Buku itu tidak berisi pelajaran bisnis, melainkan hanya kumpulan sketsa dan kutipan pendek tentang pentingnya konsistensi. Tio yang awalnya putus asa dengan pekerjaannya, akhirnya tersadar bahwa hal-hal besar dimulai dari tindakan kecil yang terus diulang. Cerpen ini bercerita tentang keajaiban dari ketekunan." }
            ],
            standup: [
                { id: 'su1', joke: "Saya coba diet karbo, tapi ternyata mie instan itu bukan karbo, itu solusi hidup. Jadi aman." },
                { id: 'su2', joke: "Kenapa alarm saya selalu berbunyi lebih cepat dari yang saya set? Karena dia tahu saya butuh waktu lebih lama untuk menerima kenyataan hari itu." },
                { id: 'su3', joke: "Paling sebel kalau lagi serius nge-game, tiba-tiba ibu bilang: 'Coba keluar, lihat matahari!'. Bu, saya lagi liburan virtual, jangan ganggu!" },
                { id: 'su4', joke: "Kemarin saya makan di restoran mewah. Saya pesan 'air putih', harganya Rp 20.000. Saya tanya, 'Ini air mineral atau air dari sumber mata air perawan?'. Pelayan jawab: 'Ini air PDAM, tapi didoakan oleh chef bintang lima, Pak.'." },
            ],
            puzzles: [
                { q: "Hewan apa yang paling banyak di internet?", a: "kucing" },
                { q: "Dibeli mahal, dibuang murah. Apakah itu?", a: "cinta" },
                { q: "Sarung apa yang bisa terbang?", a: "sarung elang" },
                { q: "Jika ada 100 soal teka-teki, dan kamu berhasil menjawab 3, apa yang kamu lakukan?", a: "lanjutkan" },
                { q: "Apa bedanya macan sama macan?", a: "tidak ada bedanya" },
            ]
        };
        
        // --- CHESS DATA & AI CONFIG ---
        const CHESS_PIECES = {
            'wK': '♔', 'wQ': '♕', 'wR': '♖', 'wB': '♗', 'wN': '♘', 'wP': '♙',
            'bK': '♚', 'bQ': '♛', 'bR': '♜', 'bB': '♝', 'bN': '♞', 'bP': '♟',
        };
        const PIECE_VALUES = {
            'K': 1000, 'Q': 9, 'R': 5, 'B': 3, 'N': 3, 'P': 1,
        };
        
        const initialChessBoard = [
            ['bR', 'bN', 'bB', 'bQ', 'bK', 'bB', 'bN', 'bR'],
            ['bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP', 'bP'],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            ['wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP', 'wP'],
            ['wR', 'wN', 'wB', 'wQ', 'wK', 'wB', 'wN', 'wR'],
        ];
        let currentChessBoard = JSON.parse(JSON.stringify(initialChessBoard));
        let isWhiteTurn = true; // White (Human) starts


        // --- HISTORY DATA ---
        const historyData = {
            sekolah: { 
                title: "Perjalanan di Bangku SMK", 
                image: 'https://placehold.co/400x200/ff0077/ffffff?text=Sekolah+SMK+Vision',
                content: "Di sinilah mimpi dan kode pertama saya dimulai. Hari-hari diisi dengan tugas proyek, tawa bersama teman, dan semangat mengejar ilmu TIK. Setiap baris kode adalah bekal untuk masa depan." 
            },
            medsos: { 
                title: "Jejak Digital dan Kreativitas", 
                image: 'https://placehold.co/400x200/00f0ff/0d1117?text=Social+Media+Journey',
                content: "Media sosial bukan hanya tempat berbagi, tapi panggung kreativitas. Dari desain visual hingga tulisan inspiratif, saya menggunakan platform ini untuk menyebarkan energi positif dan mengasah kemampuan komunikasi digital." 
            },
            kluarga: { 
                title: "Keluarga: Fondasi Kekuatan", 
                image: 'https://placehold.co/400x200/6044a0/ffffff?text=Family+Love+Gradient',
                content: "Keluarga adalah sumber kekuatan dan inspirasi yang tak pernah habis. Dukungan mereka adalah bahan bakar utama di balik setiap proyek yang saya buat, termasuk aplikasi futuristik ini." 
            },
            general: { 
                title: "Visi dan Masa Depan Campurtapipasti", 
                image: 'https://placehold.co/400x200/3d3d3d/ffffff?text=My+Visions+2025+',
                content: "Aplikasi ini adalah langkah awal. Visi saya adalah menjadikannya platform komprehensif yang terus berkembang, menggabungkan konten berkualitas tinggi, hiburan interaktif, dan teknologi terdepan." 
            },
        };


        // --- DOM ELEMENTS ---
        const splashScreen = document.getElementById('splash-screen');
        const loadingStatus = document.getElementById('loading-status');
        const offlineMessage = document.getElementById('offline-message');
        const appHeader = document.getElementById('app-header');
        const appFooter = document.getElementById('app-footer');
        const navButtons = document.querySelectorAll('.nav-btn');
        const screens = document.querySelectorAll('.screen');
        // Quotes
        const slidesContainer = document.getElementById('slides-container');
        const currentQuoteText = document.getElementById('current-quote-text');
        const currentQuoteSource = document.getElementById('current-quote-source');
        const quoteNavDots = document.getElementById('quote-nav-dots');
        // Content
        const poetryList = document.getElementById('poetry-list');
        const storyContent = document.getElementById('story-content');
        const standupList = document.getElementById('standup-list');
        // Chess
        const chessBoard = document.getElementById('chess-board');
        const chessStatus = document.getElementById('chess-status');
        const chessStatusBox = document.getElementById('chess-status-box');
        // Puzzle
        const puzzleQuestion = document.getElementById('puzzle-question');
        const puzzleInput = document.getElementById('puzzle-input');
        const puzzleMessage = document.getElementById('puzzle-message');
        const puzzleProgress = document.getElementById('puzzle-progress');
        const puzzleBar = document.getElementById('puzzle-bar');
        // History
        const historyContentArea = document.getElementById('history-content-area');
        const historyTabs = document.querySelectorAll('.history-tab');


        // --- FIREBASE & DATA FUNCTIONS (Simplified for brevity) ---

        async function initializeFirebase() {
            if (!firebaseConfig) {
                console.error("Firebase config is missing.");
                loadingStatus.textContent = "Error: Konfigurasi Firebase tidak ditemukan.";
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) { await signInWithCustomToken(auth, initialAuthToken); } 
                else { await signInAnonymously(auth); }

                return new Promise(resolve => {
                    onAuthStateChanged(auth, (user) => {
                        if (user) { userId = user.uid; }
                        isAuthReady = true;
                        resolve();
                    });
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                loadingStatus.textContent = `Error: Gagal koneksi ke server. (${error.message})`;
            }
        }

        function setupDataListeners() {
            if (!isAuthReady || !db) return;
            
            // Fill Puzzles up to 100 for robust demo
            if (initialData.puzzles.length < 100) {
                for (let i = initialData.puzzles.length; i < 100; i++) {
                    initialData.puzzles.push({
                        q: `Ini adalah soal teka-teki ke-${i + 1} yang kocak dan campur. (Jawaban: ${i + 1})`,
                        a: `${i + 1}`
                    });
                }
            }
            appState.puzzles = initialData.puzzles; 
            
            // Use placeholder data and trigger initial rendering immediately since Firebase is complex to mock
            appState.quotes = initialData.quotes;
            appState.poetry = initialData.poetry;
            appState.story = initialData.story;
            appState.standup = initialData.standup;
            
            renderQuotesSlider();
            renderPoetryList();
            renderShortStory();
            renderStandUpList();
            renderChessBoard();
            renderPuzzle();
            renderHistoryContent();
            
            hideSplashScreen();
        }

        // --- CHESS GAME LOGIC & AI ---

        /**
         * Checks if coordinates are within the board (0-7).
         */
        function isSafe(r, c) {
            return r >= 0 && r < 8 && c >= 0 && c < 8;
        }

        /**
         * Gets the piece code (e.g., 'wR', 'bP') at a specific location.
         */
        function getPiece(board, r, c) {
            return isSafe(r, c) ? board[r][c] : null;
        }

        /**
         * Generates all semi-legal moves for a specific piece (simplified).
         * This function does NOT check for check/checkmate.
         */
        function getPossibleMoves(board, fromR, fromC) {
            const pieceCode = board[fromR][fromC];
            if (!pieceCode) return [];
            
            const color = pieceCode[0];
            const type = pieceCode[1];
            const opponentColor = color === 'w' ? 'b' : 'w';
            const moves = [];

            // Helper to add moves: 
            const addMove = (r, c) => {
                if (isSafe(r, c)) {
                    const targetPiece = getPiece(board, r, c);
                    if (!targetPiece || targetPiece[0] === opponentColor) {
                        moves.push({ fromR, fromC, toR: r, toC: c });
                        return !targetPiece; // Return true if move is non-capturing (for sliding pieces)
                    }
                }
                return false; // Square is blocked or out of bounds
            };

            // --- Simplified Move Rules ---

            if (type === 'P') { // Pawn
                const dir = color === 'w' ? -1 : 1; // White moves up (lower row index), Black moves down
                
                // 1. Single move forward
                addMove(fromR + dir, fromC);

                // 2. Initial double move (Row 6 for White, Row 1 for Black)
                if ((color === 'w' && fromR === 6) || (color === 'b' && fromR === 1)) {
                    if (!getPiece(board, fromR + dir, fromC) && !getPiece(board, fromR + dir * 2, fromC)) {
                         moves.push({ fromR, fromC, toR: fromR + dir * 2, toC: fromC });
                    }
                }

                // 3. Captures (Simplified: diagonal 1 step)
                [-1, 1].forEach(dC => {
                    const targetPiece = getPiece(board, fromR + dir, fromC + dC);
                    if (targetPiece && targetPiece[0] === opponentColor) {
                        moves.push({ fromR, fromC, toR: fromR + dir, toC: fromC + dC });
                    }
                });
            } 
            else if (type === 'N') { // Knight
                [[2, 1], [2, -1], [-2, 1], [-2, -1], [1, 2], [1, -2], [-1, 2], [-1, -2]].forEach(([dR, dC]) => {
                    addMove(fromR + dR, fromC + dC);
                });
            }
            else if (type === 'R' || type === 'B' || type === 'Q') { // Rook, Bishop, Queen (Sliding Pieces)
                const directions = [];
                if (type === 'R' || type === 'Q') { // Rook/Queen: Straight
                    directions.push([0, 1], [0, -1], [1, 0], [-1, 0]);
                }
                if (type === 'B' || type === 'Q') { // Bishop/Queen: Diagonal
                    directions.push([1, 1], [1, -1], [-1, 1], [-1, -1]);
                }

                directions.forEach(([dR, dC]) => {
                    for (let step = 1; step < 8; step++) {
                        const newR = fromR + dR * step;
                        const newC = fromC + dC * step;
                        
                        if (isSafe(newR, newC)) {
                            const targetPiece = getPiece(board, newR, newC);
                            if (targetPiece) {
                                if (targetPiece[0] === opponentColor) {
                                    addMove(newR, newC); // Capture
                                }
                                break; // Stop after hitting any piece (own or opponent)
                            }
                            addMove(newR, newC); // Empty square
                        } else {
                            break; // Out of bounds
                        }
                    }
                });
            }
            else if (type === 'K') { // King
                for (let dR = -1; dR <= 1; dR++) {
                    for (let dC = -1; dC <= 1; dC++) {
                        if (dR !== 0 || dC !== 0) {
                            addMove(fromR + dR, fromC + dC);
                        }
                    }
                }
            }

            return moves;
        }

        /**
         * Generates ALL possible moves for the given color.
         */
        function generateAllMoves(board, color) {
            let allMoves = [];
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const pieceCode = board[r][c];
                    if (pieceCode && pieceCode[0] === color) {
                        allMoves = allMoves.concat(getPossibleMoves(board, r, c));
                    }
                }
            }
            return allMoves;
        }

        /**
         * Evaluates the board based on material advantage.
         * Positive score favors White (W), Negative favors Black (B).
         */
        function evaluateBoard(board) {
            let score = 0;
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const pieceCode = board[r][c];
                    if (pieceCode) {
                        const color = pieceCode[0];
                        const type = pieceCode[1];
                        const value = PIECE_VALUES[type];
                        score += (color === 'w' ? value : -value);
                    }
                }
            }
            return score;
        }

        /**
         * Executes a move on a simulated board (returns a new board state).
         */
        function executeMove(board, move) {
            const newBoard = JSON.parse(JSON.stringify(board));
            const piece = newBoard[move.fromR][move.fromC];
            newBoard[move.toR][move.toC] = piece;
            newBoard[move.fromR][move.fromC] = null;
            return newBoard;
        }
        
        /**
         * The AI logic: searches for the best material-gaining move (Depth 1).
         * Since AI is Black, it seeks to MINIMIZE the score (make it more negative).
         */
        function findBestMove(board) {
            const allBlackMoves = generateAllMoves(board, 'b');
            let bestScore = Infinity;
            let bestMove = null;

            if (allBlackMoves.length === 0) return null; // No legal moves

            // Prioritize random for same score to avoid repetitive moves
            const shuffledMoves = allBlackMoves.sort(() => 0.5 - Math.random());

            for (const move of shuffledMoves) {
                const newBoard = executeMove(board, move);
                const score = evaluateBoard(newBoard);
                
                // Black wants to minimize the score (make it more negative)
                if (score < bestScore) {
                    bestScore = score;
                    bestMove = move;
                }
            }

            return bestMove;
        }
        
        /**
         * Executes the AI's best move after a delay.
         */
        function aiMove() {
            if (isWhiteTurn) return; // Should not happen

            chessStatusBox.classList.add('thinking');
            updateChessStatus("AI (Hitam) sedang berpikir...");
            appState.isAITurn = true;

            setTimeout(() => {
                const move = findBestMove(currentChessBoard);
                
                chessStatusBox.classList.remove('thinking');

                if (move) {
                    console.log("AI Move:", move);
                    // Execute the best move
                    currentChessBoard = executeMove(currentChessBoard, move);
                    
                    isWhiteTurn = true; // Hand turn back to White (Human)
                    appState.isAITurn = false;
                    renderChessBoard();
                    updateChessStatus("Giliran Putih");
                } else {
                    updateChessStatus("GAME OVER: Hitam tidak bisa bergerak!");
                    appState.isAITurn = false;
                }
            }, 1000); // 1 second delay for "thinking" effect
        }

        /**
         * Renders the 8x8 chess board with pieces.
         */
        function renderChessBoard() {
            chessBoard.innerHTML = '';
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const square = document.createElement('div');
                    square.id = `sq-${r}${c}`;
                    square.className = `chess-square ${((r + c) % 2 === 0) ? 'light' : 'dark'}`;
                    square.setAttribute('data-row', r);
                    square.setAttribute('data-col', c);
                    // Only allow clicks if it's NOT the AI's turn
                    if (!appState.isAITurn) {
                         square.onclick = handleChessClick;
                    }
                    
                    const pieceCode = currentChessBoard[r][c];
                    if (pieceCode) {
                        const pieceElement = document.createElement('span');
                        pieceElement.className = (pieceCode.startsWith('w')) ? 'white-piece' : 'black-piece';
                        pieceElement.textContent = CHESS_PIECES[pieceCode];
                        square.appendChild(pieceElement);
                    }
                    chessBoard.appendChild(square);
                }
            }
            updateChessStatus();
        }

        /**
         * Updates the status message below the chess board.
         */
        function updateChessStatus(message) {
            if (appState.isAITurn) {
                chessStatus.textContent = message || "AI (Hitam) sedang berpikir...";
                chessStatus.className = 'text-lg font-medium text-secondary-accent';
            } else {
                chessStatus.textContent = message || (isWhiteTurn ? 'Giliran Putih' : 'Giliran Hitam');
                chessStatus.className = `text-lg font-medium ${isWhiteTurn ? 'text-accent-color' : 'text-secondary-accent'}`;
            }
        }

        /**
         * Handles human piece selection and movement.
         */
        function handleChessClick(event) {
            if (!isWhiteTurn || appState.isAITurn) return; // Only allow human (White) clicks when it's their turn
            
            const square = event.currentTarget;
            const r = parseInt(square.getAttribute('data-row'));
            const c = parseInt(square.getAttribute('data-col'));
            const pieceCode = currentChessBoard[r][c];
            
            // Clear all highlights
            document.querySelectorAll('.chess-square').forEach(sq => {
                sq.classList.remove('selected', 'highlight');
            });

            if (appState.chessSelectedSquare) {
                // MOVE PHASE
                const [fromR, fromC] = appState.chessSelectedSquare;
                
                // Simplified move validation (check if move is in the possible moves list)
                const possibleMoves = getPossibleMoves(currentChessBoard, fromR, fromC);
                const isMoveValid = possibleMoves.some(m => m.toR === r && m.toC === c);

                if (isMoveValid) {
                    // Perform move
                    currentChessBoard[r][c] = currentChessBoard[fromR][fromC];
                    currentChessBoard[fromR][fromC] = null;
                    appState.chessSelectedSquare = null;
                    
                    isWhiteTurn = false; // Toggle turn to Black (AI)
                    renderChessBoard();
                    aiMove(); // Trigger AI move
                    
                } else if (pieceCode && pieceCode.startsWith('w')) {
                    // Clicks on another own piece, change selection
                    square.classList.add('selected');
                    appState.chessSelectedSquare = [r, c];
                    updateChessStatus("Pilih kotak tujuan untuk Putih...");
                } else {
                    updateChessStatus("Langkah tidak valid atau kotak tidak kosong.");
                }

            } else if (pieceCode && pieceCode.startsWith('w')) {
                // SELECTION PHASE (Only allow selecting White pieces)
                square.classList.add('selected');
                appState.chessSelectedSquare = [r, c];
                updateChessStatus("Pilih kotak tujuan untuk Putih...");
                
                // Highlight possible moves (for visual feedback)
                getPossibleMoves(currentChessBoard, r, c).forEach(move => {
                    document.getElementById(`sq-${move.toR}${move.toC}`).classList.add('highlight');
                });
            } else {
                 updateChessStatus("Pilih bidak Putih untuk bergerak.");
            }
        }

        document.getElementById('reset-chess-btn').addEventListener('click', () => {
            currentChessBoard = JSON.parse(JSON.stringify(initialChessBoard));
            isWhiteTurn = true;
            appState.chessSelectedSquare = null;
            appState.isAITurn = false;
            renderChessBoard();
            updateChessStatus("Game Baru: Giliran Putih");
        });


        // --- REMAINING UI/APP LOGIC (Unchanged) ---
        // (Quotes, Poetry, Story, Standup, Puzzle, History, App Flow functions remain here...)

        // Quote Slider logic (Unchanged for brevity)
        let slideshowInterval;
        function stopSlideShow() { if (slideshowInterval) clearInterval(slideshowInterval); }
        function goToSlide(index) {
            if (index >= appState.quotes.length) index = 0;
            if (index < 0) index = appState.quotes.length - 1;
            appState.currentSlideIndex = index;
            document.querySelectorAll('.quote-slide').forEach((slide, i) => { slide.style.opacity = i === index ? 1 : 0; });
            document.querySelectorAll('#quote-nav-dots button').forEach((dot, i) => {
                dot.className = `w-3 h-3 rounded-full transition-colors duration-300 ${i === index ? 'bg-accent-color neon-btn' : 'bg-gray-500 hover:bg-gray-300'}`;
            });
            updateQuoteText();
        }
        function updateQuoteText() {
            const quote = appState.quotes[appState.currentSlideIndex];
            if (quote) { currentQuoteText.textContent = quote.text; currentQuoteSource.textContent = `- ${quote.source}`; }
        }
        function startSlideShow() {
            stopSlideShow();
            slideshowInterval = setInterval(() => { goToSlide(appState.currentSlideIndex + 1); }, 5000); 
        }
        function renderQuotesSlider() {
            slidesContainer.innerHTML = '';
            quoteNavDots.innerHTML = '';
            appState.quotes.forEach((quote, index) => {
                const slide = document.createElement('div');
                slide.className = 'quote-slide absolute w-full h-full inset-0 transition-opacity duration-1000 bg-cover bg-center';
                slide.style.backgroundImage = `url('${quote.image}')`;
                slide.style.opacity = index === appState.currentSlideIndex ? 1 : 0;
                slide.setAttribute('data-index', index);
                slidesContainer.appendChild(slide);
                const dot = document.createElement('button');
                dot.className = `w-3 h-3 rounded-full transition-colors duration-300 ${index === appState.currentSlideIndex ? 'bg-accent-color neon-btn' : 'bg-gray-500 hover:bg-gray-300'}`;
                dot.onclick = () => { stopSlideShow(); goToSlide(index); startSlideShow(); };
                quoteNavDots.appendChild(dot);
            });
            updateQuoteText();
        }

        // Content Rendering (Unchanged for brevity)
        function renderPoetryList() {
            const listContainer = document.getElementById('poetry-list');
            listContainer.innerHTML = appState.poetry.map((p, index) => `
                <div class="futuristic-card p-4 rounded-xl shadow-lg border-l-4 border-accent-color">
                    <h4 class="text-xl font-bold text-accent-color mb-2">${index + 1}. ${p.title}</h4>
                    <p class="text-sm text-gray-300 whitespace-pre-line">${p.content}</p>
                </div>
            `).join('');
        }
        function renderShortStory() {
            const story = appState.story[0];
            if (story) { storyContent.innerHTML = `<h4 class="text-2xl font-bold text-secondary-accent mb-3">${story.title}</h4><p class="text-base text-gray-300 whitespace-pre-line">${story.content}</p>`; } 
            else { storyContent.innerHTML = `<p class="text-gray-400">Belum ada cerpen yang dimuat.</p>`; }
        }
        function renderStandUpList() {
            standupList.innerHTML = appState.standup.map((j, index) => `
                <div class="futuristic-card p-4 rounded-xl shadow-lg border-l-4 border-secondary-accent flex items-start">
                    <span class="text-secondary-accent font-extrabold text-2xl mr-3">${index + 1}.</span>
                    <p class="text-base text-white flex-grow">${j.joke}</p>
                </div>
            `).join('');
        }

        // Puzzle Game Logic (Unchanged for brevity)
        function renderPuzzle() {
            const current = appState.puzzles[appState.currentPuzzleIndex];
            if (current) {
                puzzleQuestion.textContent = current.q;
                puzzleProgress.textContent = `Soal ${appState.currentPuzzleIndex + 1} dari ${appState.puzzles.length}`;
                const progressWidth = ((appState.currentPuzzleIndex + 1) / appState.puzzles.length) * 100;
                puzzleBar.style.width = `${progressWidth}%`;
                puzzleInput.value = '';
                puzzleMessage.classList.add('hidden');
                puzzleInput.style.display = 'block';
                document.getElementById('submit-answer-btn').style.display = 'block';
                document.getElementById('submit-answer-btn').textContent = "Jawab";
                document.getElementById('submit-answer-btn').onclick = submitAnswer;
                puzzleInput.focus();
            } else {
                puzzleQuestion.textContent = "Selamat! Semua 100 teka-teki telah selesai!";
                puzzleInput.style.display = 'none';
                document.getElementById('submit-answer-btn').style.display = 'none';
                puzzleProgress.textContent = `Selesai: 100 dari 100`;
                puzzleBar.style.width = `100%`;
            }
        }
        function submitAnswer() {
            const current = appState.puzzles[appState.currentPuzzleIndex];
            if (!current) return;
            const userAnswer = puzzleInput.value.trim().toLowerCase();
            const correctAnswer = current.a.trim().toLowerCase();
            puzzleMessage.classList.remove('hidden');
            if (userAnswer === correctAnswer) {
                puzzleMessage.textContent = "BENAR! Jawabanmu kocak juga. Klik Soal Berikutnya.";
                puzzleMessage.className = 'text-lg font-bold mb-3 text-accent-color';
                document.getElementById('submit-answer-btn').textContent = "Soal Berikutnya >>";
                document.getElementById('submit-answer-btn').onclick = nextPuzzle;
            } else {
                puzzleMessage.textContent = "SALAH! Coba lagi, jangan sampai ngakak duluan.";
                puzzleMessage.className = 'text-lg font-bold mb-3 text-secondary-accent';
            }
        }
        function nextPuzzle() {
            appState.currentPuzzleIndex++;
            if (appState.currentPuzzleIndex < appState.puzzles.length) { renderPuzzle(); } 
            else { renderPuzzle(); } 
        }
        document.getElementById('submit-answer-btn').addEventListener('click', submitAnswer);
        puzzleInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && document.getElementById('submit-answer-btn').textContent === 'Jawab') { submitAnswer(); }
        });

        // History Visuals Logic (Unchanged for brevity)
        function renderHistoryContent() {
            const theme = appState.historyTheme;
            const data = historyData[theme];
            historyContentArea.innerHTML = `
                <div class="mb-4">
                    <img src="${data.image}" alt="Visual ${data.title}" class="w-full rounded-xl object-cover shadow-lg border border-gray-700">
                </div>
                <h3 class="text-2xl font-bold text-accent-color mb-3 border-b border-gray-700 pb-1">${data.title}</h3>
                <p class="text-base text-gray-300 leading-relaxed">${data.content}</p>
            `;
            historyTabs.forEach(tab => {
                const isActive = tab.getAttribute('data-theme') === theme;
                tab.className = `history-tab px-4 py-2 rounded-full text-sm font-medium transition duration-300 ${
                    isActive ? 'bg-secondary-accent/20 text-secondary-accent border border-secondary-accent' : 'bg-gray-700 text-gray-400 hover:bg-secondary-accent/10 hover:text-secondary-accent'
                }`;
            });
        }
        historyTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                appState.historyTheme = tab.getAttribute('data-theme');
                renderHistoryContent();
            });
        });


        // --- APPLICATION FLOW (Unchanged) ---
        function switchScreen(screenName) {
            screens.forEach(screen => {
                screen.style.display = (screen.getAttribute('data-screen-name') === screenName) ? 'block' : 'none';
                if (screen.getAttribute('data-screen-name') === screenName) { screen.scrollTop = 0; }
            });
            navButtons.forEach(button => {
                const isActive = button.getAttribute('data-target') === screenName;
                button.classList.toggle('text-accent-color', isActive);
                button.classList.toggle('text-gray-400', !isActive);
                button.classList.toggle('hover:text-accent-color', !isActive);
            });
            appState.currentScreen = screenName;
            if (screenName === 'home') { startSlideShow(); } else { stopSlideShow(); }
            if (screenName === 'chess') renderChessBoard();
            if (screenName === 'puzzle') renderPuzzle();
            if (screenName === 'history') renderHistoryContent();
        }

        function hideSplashScreen() {
            setTimeout(() => {
                splashScreen.style.opacity = 0;
                appHeader.classList.remove('hidden');
                appFooter.classList.remove('hidden');
                switchScreen('home');
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 500);
            }, 1000);
        }

        navButtons.forEach(button => {
            button.addEventListener('click', () => { switchScreen(button.getAttribute('data-target')); });
        });
        document.getElementById('show-about-me').addEventListener('click', () => {
            aboutModal.classList.add('flex'); aboutModal.classList.remove('hidden');
        });
        document.getElementById('close-about-modal').addEventListener('click', () => {
            aboutModal.classList.add('hidden'); aboutModal.classList.remove('flex');
        });

        async function startApp() {
            splashScreen.style.display = 'flex';
            loadingStatus.textContent = "Memeriksa Koneksi Jaringan...";

            if (navigator.onLine) {
                loadingStatus.textContent = "Koneksi OK. Memuat Data dari Server...";
                await initializeFirebase();
                setupDataListeners();
            } else {
                loadingStatus.style.display = 'none';
                offlineMessage.classList.remove('hidden');
            }
        }

        window.onload = startApp;

    </script>
</body>
</html>
